---
title: "Getting Started"
author:
- name: Pascal Maas
  affiliation: >
   Leiden Academic Centre for Drug Research, 
   Leiden University, Netherlands
  email: p.maas@lacdr.leidenuniv.nl
  
date: "`r Sys.Date()`"
output: 
  html_document:
      theme: united
      highlight: tango
vignette: >
  %\VignetteIndexEntry{Getting Started}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = FALSE)
suppressPackageStartupMessages(library(sumR))
```

sumR starts by pre-processing the raw data to features by extracting peaks and 
aligning these across spectra and cells. Unlike LC-MS, here we define a peak as 
a m/z -- intensity combination, and features as peaks that have been aligned 
across cells. This allows us to compare cells by e.g. filtering possible 
contaminants and/or performing statistical modelling. Consequently, features 
are defined using a min -- max m/z range across cells. Be aware that due to 
the acquisition method, sumR does not consider retention time of samples and 
will be omitted throughout the workflow.

To start a sumR pipeline, we need to load the package.

```{r setupEcho, echo = T, eval = F}
library(sumR)
```

```{r setup, echo = F, include=FALSE}
suppressWarnings(suppressPackageStartupMessages(library(sumR)))
```

### Converting vendor format

SumR requires that the data is in `mzML` file format. In case you have vendor 
format files, you can use the `rawToMzml` function to convert the files to mzML 
files. This function requires Proteowizard to be installed on your system, 
which you can find [here](https://proteowizard.sourceforge.io/). Alternatively, 
you can use Proteowizard without sumR to perform the conversion and skip this 
section.

After obtaining mzML files, we set the directory where our data is located. The 
path to the directory needs to be the full path, which can be assured with the 
`file.path()` function.

The rawToMzml function requires the defined input directory and an output 
folder to store the mzML files. It is recommended to use an empty or 
non-existing folder to ensure the output folder only contains mzML files. The 
function returns the file paths of the newly created mzML files.

```{r convert}
# Change this these paths to where you extracted the files and desired output
input_directory <- r"(F:\Myrthe\raw)"
output_directory <- r"(F:\Myrthe\mzml)"

dir <- file.path(input_directory)
files <- rawToMzml(dir, output = file.path(output_directory))
```

### Defining Metadata

To make use of the full pipeline, it is required to supply a data frame of 
metadata called `cellData`. To ensure proper integration, ensure that the row 
names are equal to the base name of the file, without file extension. E.g. a 
file called `sample001.mzML` would translate into `sample001` as a proper row 
name. This name is matched to the data file names to match data with the 
supplied cellData.

Columns may contain metadata about each of the cells. Here we prepared metadata 
with two additional columns: `Type`, and `Treatment`. The first column contains 
the sample type, here either `SAMPLE` or `BLANK`, the second column if the cell 
was treated with either DMSO or TMX. We will use the Treatment column as 
phenotype during modelling after post-processing. The supplied table below 
shows the contents of the cellData.

```{r echo = F}
cellData <- system.file("cellData.csv", package = "sumR")
df <- read.csv(cellData, row.names = 1)
knitr::kable(df, caption = "cellData") 
```

