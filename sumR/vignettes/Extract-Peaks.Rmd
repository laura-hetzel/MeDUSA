---
title: "Extract Peaks"
author:
- name: Pascal Maas
  affiliation: >
   Leiden Academic Centre for Drug Research, 
   Leiden University, Netherlands
  email: p.maas@lacdr.leidenuniv.nl
  
date: "`r Sys.Date()`"
output: 
  html_document:
      theme: united
      highlight: tango
vignette: >
  %\VignetteIndexEntry{Extract Peaks}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = TRUE)
suppressPackageStartupMessages(library(sumR))
```

### Defining files
For this example article a subset of 8 cells (4 samples, 4 blanks) within a mass
window of 250 - 300 and a retention time of 5 - 25 seconds has been selected.
We can define the files as follows:

```{r files}
folder <- system.file("cells", package = "sumR")
files <- list.files(folder, full.names = TRUE)
basename(files)
```

### Extracting peaks

Peaks can be extracted from the mzML file using the `extractPeaks()` function. This function converts profile-mode data to centroid-mode by doing the following steps:

1.  Extract scans within a massWindow (e.g. a scan of 200-350 dalton has a massWindow of 150 dalton). Defaults to `c(0, Inf)` which extracts everything.
2.  Extract scans of either positive (+) or negative (-) polarity.
3.  Smooth these scans using a Savitzky-Golay filter
4.  Centroid by picking local maxima

By setting `cores` to any value higher than 1, each scan is centroided in parallel using that amount of cores. The function returns a list of data frames, one for each cell.

```{r prepareScans}
peaks <- extractPeaks(
  files, 
  polarity = "+",
  cores = 1
)
```

We can plot the result of this function using a `spectrumPlot`. This plots the centroided peaks of a single scan by providing the filename and a scan number:

```{r spectrumPlot}
spectrumPlot(peaks, file = 1, scan = 1)
```

```{r showAlignment, include=FALSE}
knitr::kable(head(peaks[[1]]), caption = sprintf("Peaks found in %s", names(peaks)[1]))
```

# SessionInfo
```{r, echo = FALSE}
if (requireNamespace("devtools", quietly = TRUE)) {
  devtools::session_info("attached")
}
```
