---
title: "Workflow"
author:
- name: Pascal Maas
  affiliation: >
   Leiden Academic Centre for Drug Research, 
   Leiden University, Netherlands
  email: p.maas@lacdr.leidenuniv.nl
  
date: "`r Sys.Date()`"
output: 
  html_document:
      theme: united
      highlight: tango
vignette: >
  %\VignetteIndexEntry{Workflow}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = FALSE)
suppressPackageStartupMessages(library(sumR))
```

We can combine the functions of the pre- and post-processing in a pipeline using the 'pipe' notation of the `dplyr` package. Here we are using the same settings as the previous steps except for positive polarity instead of negative polarity.

```{r pipeline}
# Pre-processing
exp2 <- extractPeaks(files, polarity = "-", cores = 8) %>%
  spectraAlignment(method = "binning", ppm = 5, nPeaks = 5) %>%
  cellAlignment(method = "binning", ppm = 5, nCells = 10, cellData = df, phenotype = "Treatment")

# Post-processing
exp2 <- exp2 %>%
  blankSubstraction(foldChange = 5, nSamples = 10, removeBlanks = TRUE) %>%
  massDefectFilter() %>%
  imputation(method = "noise", noise = 100, seed = 42) %>%
  isotopeTagging(corr = 0.8) %>%
  fragmentFilter(method = "spearman", corr = 0.95)
```

### Combining experiments

We can combine the features found in both polarities with the `combineExperiments()` function. This function takes in any number of `SummarizedExperiment` objects with the assumption of equal 'colData'. The function combines these objects row-wise, essentially adding features together and returns a new SummarizedExperiment object.

```{r comb}
expModel <- combineExperiments(exp, exp2)
expModel
```

# SessionInfo
```{r, echo = FALSE}
if (requireNamespace("devtools", quietly = TRUE)) {
  devtools::session_info("attached")
}
```
